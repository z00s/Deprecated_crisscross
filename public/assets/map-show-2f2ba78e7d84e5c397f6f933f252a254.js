function initialize(){markers=new Array,mapDiv=document.getElementById("map_canvas"),centerLatLng=new google.maps.LatLng(centerLatitude,centerLangitude);var e={center:centerLatLng,zoom:startZoom,mapTypeId:google.maps.MapTypeId.ROADMAP};currentMap=new google.maps.Map(mapDiv,e),setAllMarkers(currentMap,getCurrentMapID())}function toggleBounce(e){e.setAnimation(null!=e.getAnimation()?null:google.maps.Animation.BOUNCE)}function createInfoWindow(e,a){var r=a.position.lat().toFixed(6),t=a.position.lng().toFixed(6),n=getCurrentMapID(),o={marker:{map_id:n,lat:r,lng:t}};$.ajax({type:"POST",url:"/maps/check_marker",data:o,dataType:"json",success:function(r){if(r.success){a.setDraggable(!1);var t=r;createNormalInfoWnd(e,a,n,t)}else alert("\u5bf9\u4e0d\u8d77\uff0c\u83b7\u53d6\u4fe1\u606f\u5931\u8d25\uff01")},error:function(e,a,r){alert("\u5d29\u6e83\u4e86!!!"),alert(r)}})}function createMarker(e,a,r){lastInfWnd&&lastInfWnd.close();var t=1;if(markers.length>0)for(i=0;i<markers.length;i++)markers[i].position==a&&(t=-1);if(1==t){var n=new google.maps.Marker({map:e,position:a,title:r,draggable:!0,animation:google.maps.Animation.DROP});markers.push(n),e.setCenter(a),google.maps.event.addListener(n,"click",function(){createInfoWindow(currentMap,n),toggleBounce(n)})}}function setAllMarkers(e,a){var r={map:{map_id:a}};alert(a),$.ajax({type:"POST",url:"/maps/find_markers",data:r,dataType:"json",success:function(a){var r=a.success;if(r){for(i=0;i<a.markers.length;i++){var t=new google.maps.LatLng(a.markers[i].lat,a.markers[i].lng),n=a.markers[i].title;createMarker(e,t,n)}for(i=0;i<markers.length;i++)markers[i].setDraggable(!1);0!=markers.length&&e.setCenter(markers[0].position)}else alert(a.content)},error:function(){alert("\u4fdd\u5b58\u5931\u8d25\uff01\u7a0d\u540e\u91cd\u8bd5\uff01")}})}function createNormalInfoWnd(e,a,r,t){lastInfWnd&&lastInfWnd.close();var n=new google.maps.InfoWindow,o=$('<div ><h6 class="page-header" style="margin: 0px">'+t.marker.title+"</h4>"+t.marker.desc+"</div>");n.setContent(o[0]),n.open(e,a),lastInfWnd=n;var i=o.find("input.remove-marker")[0];google.maps.event.addDomListener(i,"click",function(){removeMarker(a,n,getCurrentMapID())})}var centerLatitude=31.4829,centerLangitude=120.2776,centerLatLng,startZoom=13,markers,lastInfWnd,currentMap,geocoder,recvResults,mapDiv,directionsDisplay,directionsService;