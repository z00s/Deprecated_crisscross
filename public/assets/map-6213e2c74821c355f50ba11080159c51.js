function initialize(){markers=new Array,mapDiv=document.getElementById("map_canvas"),centerLatLng=new google.maps.LatLng(centerLatitude,centerLangitude),directionsDisplay=new google.maps.DirectionsRenderer,directionsService=new google.maps.DirectionsService;var e={center:centerLatLng,zoom:startZoom,mapTypeId:google.maps.MapTypeId.ROADMAP};myMap=new google.maps.Map(mapDiv,e),directionsDisplay.setMap(myMap),directionsDisplay.setPanel(document.getElementById("routes-result")),google.maps.event.addListener(myMap,"click",function(e){createMarker(myMap,e.latLng,"123")})}function createMarker(e,t,a){lastInfWnd&&lastInfWnd.close();var n=1;if(alert(n),markers.length>0)for(i=0;i<markers.length;i++)markers[i].position==t&&(n=-1,alert(n));if(1==n){var o=new google.maps.Marker({map:e,position:t,title:a,draggable:!0,animation:google.maps.Animation.DROP});markers.push(o),e.setCenter(t),google.maps.event.addListener(o,"click",function(){createInfoWindow(myMap,o),toggleBounce(o)}),google.maps.event.addListener(o,"rightclick",function(){removeMarker(o,null)})}alert(markers.length)}function createInfoWindow(e,t){var a=t.position.lat().toFixed(6)+","+t.position.lng().toFixed(6),n=$('<div ><h6 class="page-header" style="margin: 0px">\u6dfb\u52a0\u6807\u8bb0</h4><table class="table-responsive"><tr><td>\u6807\u9898:</td>       <td><input class="title" type="text" id="title" placeholder="\u6807\u9898"/> </td> </tr><tr><td>\u7ecf\u7ef4\u5ea6:</td>     <td><input class="coords" type="text" value = '+a+' id="loc"></td> </tr><tr><td>\u63cf\u8ff0\u5185\u5bb9:</td>   <td><textarea class="desc" rows="3" id="desc" placeholder="\u5185\u5bb9"/></td> </tr><tr><td>\u6dfb\u52a0\u56fe\u7247</td>    <td><input class="img" type="text img" id="img"/></td> </tr><tr><td></td>           <td><input class="btn btn-primary save-marker" type="button" value="\u6807\u8bb0"/><input class="btn btn-danger remove-marker" type="button" value="\u53d6\u6d88"/></td></tr></div>'),o=new google.maps.InfoWindow;o.setContent(n[0]),o.open(e,t),lastInfWnd=o;var r=n.find("input.save-marker")[0],i=n.find("input.remove-marker")[0];"undefined"!=typeof r&&google.maps.event.addDomListener(r,"click",function(){var e=n.find("input.title")[0].value,a=n.find("textarea.desc")[0].value;saveMarker(e,a,t)}),google.maps.event.addDomListener(i,"click",function(){removeMarker(t,o)})}function saveMarker(e,t,a){alert("you click save!");var n=a.getPosition().toUrlValue();alert(n)}function removeMarker(e,t){for(alert(e.position),i=0;i<markers.length;i++)(markers[i].position=e.position)&&(markers.splice(i,1),alert(markers.length));if(null!=t&&t.close(),e.getDraggable)e.setMap(null);else{var a=e.getPosition().toUrlValue(),n={del:"true",latLng:a};$.ajax({type:"POST",url:"",data:n,success:function(t){e.setMap(null),alert(t)},error:function(e,t,a){alert(a)}})}}function searchPlace(){var e=$("#address").val();return""==e?(alert("\u8bf7\u8f93\u5165\u8981\u5b9a\u4f4d\u7684\u5730\u540d\uff01"),!1):(myGeocoder=new google.maps.Geocoder,void(myGeocoder&&myGeocoder.geocode({address:e},function(t,a){a==google.maps.GeocoderStatus.OK?(alert(e),myResults=t,createPanels(t),focusMarker(0)):alert("\u8c37\u6b4c\u5730\u56fe\u6ca1\u6709\u627e\u5230\u7684\u539f\u56e0\u662f:"+a)})))}function searchNavigation(){var e=document.getElementById("origin").value,t=document.getElementById("destination").value;alert(e+"-->"+t);var a={origin:e,destination:t,travelMode:google.maps.TravelMode.TRANSIT,provideRouteAlternatives:!0};directionsService.route(a,function(e,t){t==google.maps.DirectionsStatus.OK?directionsDisplay.setDirections(e):alert(t)})}function createPanels(e){var t=$("#places-result");t.empty();for(var a=0;a<e.length;a++)createPanel(e[a],a)}function createPanel(e,t){var a=e.address_components[t].short_name,n=e.formatted_address,o=$("#result"),r='<div id="panel_'+t+'" class="panel panel-primary" style="background-color: #333333" onclick="focusMarker('+t+')"><div class="panel-heading"><h3 class="panel-title" id="title_'+t+'">'+a+'</h3></div><div class="panel-body"><div id="info_'+t+'">'+n+"</div></div></div>";o.append(r)}function toggleBounce(e){e.setAnimation(null!=e.getAnimation()?null:google.maps.Animation.BOUNCE)}function focusMarker(e){myMap.setCenter(myResults[e].geometry.location),createMarker(myMap,myResults[e].geometry.location,myResults[e].address_components[e].short_name)}function validate(){alert(document.getElementById("username").value),alert(document.getElementById("password").value),alert(document.getElementById("check").value)}function t(e){google.maps.event.addListener(myMap,"zoom_changed",function(){var t=map.getZoom();e.setContent("Zoom: "+t)})}function attachMessage(e){var t="This is a secret message!",a=new google.maps.InfoWindow({content:t,size:new google.maps.Size(50,50)});google.maps.event.addListener(e,"click",function(){a.open(myMap,e)})}var centerLatitude=31.4829,centerLangitude=120.2776,centerLatLng,startZoom=13,markers,myMap,myGeocoder,myResults,mapDiv,lastInfWnd,directionsDisplay,directionsService,xmlHttp;